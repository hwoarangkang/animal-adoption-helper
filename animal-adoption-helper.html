<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‹•ç‰©èªé ˜é¤Šå°å¹«æ‰‹</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¶</text></svg>">
    
    <style>
        body {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            font-family: "Microsoft JhengHei", "Heiti TC", sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }
        
        /* ç¯©é¸å€å¡Š */
        .filter-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: #fff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            justify-content: center;
            align-items: center;
        }
        select, button {
            padding: 10px 14px;
            border: 1px solid #e1e4e8;
            border-radius: 8px;
            font-size: 14px;
            min-width: 110px; /* ç¨å¾®ç¸®çª„ä¸€é»ä»¥å®¹ç´æ›´å¤šé¸é … */
            background-color: white;
            transition: all 0.2s ease;
        }
        select:focus { border-color: #4CAF50; outline: none; }
        
        button.sort-btn {
            background: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            min-width: 140px;
        }
        button.sort-btn:hover { background: #43a047; transform: translateY(-1px); }
        button.sort-btn.active { background: #2e7d32; }

        /* å¡ç‰‡ç¶²æ ¼ */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .animal-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid transparent;
        }
        .animal-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #4CAF50;
        }
        .animal-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background-color: #f0f0f0;
        }
        .animal-info { padding: 12px; }
        
        .tag-row { display: flex; gap: 6px; margin-bottom: 6px; flex-wrap: wrap; }
        .tag { padding: 3px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .tag.dog { background: #fff3e0; color: #ef6c00; }
        .tag.cat { background: #f3e5f5; color: #8e24aa; }
        .tag.other { background: #e0f2f1; color: #00695c; }
        .tag.male { background: #e3f2fd; color: #1976d2; }
        .tag.female { background: #fce4ec; color: #c2185b; }
        .tag.info { background: #f5f5f5; color: #666; } /* æ–°å¢ä¸€èˆ¬è³‡è¨Šæ¨™ç±¤ */
        
        .shelter-name {
            font-size: 14px; font-weight: bold; color: #2c3e50;
            margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .days-count { color: #d32f2f; font-weight: bold; font-size: 12px; margin-top: 6px; }

        /* å½ˆå‡ºè¦–çª— (ç·Šæ¹Šç‰ˆæ¨£å¼) */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
            padding: 10px;
        }
        .modal-content {
            background: white;
            width: 100%;
            max-width: 800px;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            max-height: 95vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .close-btn {
            position: absolute;
            top: 10px; right: 10px;
            font-size: 20px;
            cursor: pointer;
            color: #fff;
            width: 30px; height: 30px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            z-index: 10;
        }
        .close-btn:hover { background: rgba(0,0,0,0.8); }

        .modal-body {
            display: flex;
            flex-direction: column;
            padding: 0;
        }

        /* é›»è…¦ç‰ˆï¼šå·¦åœ–å³æ–‡ */
        @media (min-width: 768px) {
            .modal-body {
                flex-direction: row;
                height: 550px;
            }
            .modal-left {
                width: 45%;
                background: #000;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .modal-right {
                width: 55%;
                padding: 20px;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
            }
            .modal-img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                max-height: none;
            }
        }

        /* æ‰‹æ©Ÿç‰ˆï¼šç·Šæ¹Šä¸Šä¸‹ */
        @media (max-width: 767px) {
            .modal-body { flex-direction: column; }
            .modal-left { width: 100%; height: 250px; background: #000; }
            .modal-img { width: 100%; height: 100%; object-fit: contain; }
            .modal-right { padding: 15px; }
        }

        .modal-title {
            font-size: 1.2rem; font-weight: bold; color: #2c3e50;
            margin-bottom: 10px; border-bottom: 2px solid #f0f0f0; padding-bottom: 5px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 15px;
            font-size: 13px;
        }
        
        .info-item {
            display: flex;
            align-items: baseline;
            border-bottom: 1px dashed #eee;
            padding-bottom: 3px;
        }
        .info-label { color: #888; width: 90px; flex-shrink: 0; }
        .info-value { font-weight: bold; color: #333; word-break: break-all;}
        .full-width { grid-column: 1 / -1; }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .action-btn {
            color: white; text-align: center;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer; font-weight: bold; border: none;
            display: flex; align-items: center; justify-content: center; gap: 5px;
            font-size: 13px;
            transition: all 0.2s;
        }
        .btn-copy { background: #1877F2; }
        .btn-copy.success { background: #4CAF50; pointer-events: none; }
        .btn-img { background: #FF9800; }
        .tip-text { text-align: center; font-size: 11px; color: #999; margin-top: 5px; }

        /* åˆ†é èˆ‡è®€å– */
        .pagination { display: flex; justify-content: center; gap: 5px; margin-top: 30px; padding-bottom: 30px; }
        .pagination button { min-width: 35px; background: white; color: #333; padding: 5px 10px; }
        .pagination button.active { background: #4CAF50; color: white; border-color: #4CAF50; }

        .loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.95);
            display: flex; justify-content: center; align-items: center; z-index: 2000; flex-direction: column;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50; border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        @media (max-width: 600px) {
            .filter-group { flex-direction: column; }
            select, button { width: 100%; }
        }
    </style>
</head>
<body>
    <h1>ğŸ¶ å‹•ç‰©èªé ˜é¤Šå°å¹«æ‰‹</h1>
    
    <div class="filter-group">
        <select id="areaSelect" onchange="applyFilters()">
            <option value="">ğŸ  å…¨éƒ¨åœ°å€</option>
            <option value="2">è‡ºåŒ—å¸‚</option>
            <option value="3">æ–°åŒ—å¸‚</option>
            <option value="4">åŸºéš†å¸‚</option>
            <option value="5">å®œè˜­ç¸£</option>
            <option value="6">æ¡ƒåœ’å¸‚</option>
            <option value="7">æ–°ç«¹ç¸£</option>
            <option value="8">æ–°ç«¹å¸‚</option>
            <option value="9">è‹—æ —ç¸£</option>
            <option value="10">è‡ºä¸­å¸‚</option>
            <option value="11">å½°åŒ–ç¸£</option>
            <option value="12">å—æŠ•ç¸£</option>
            <option value="13">é›²æ—ç¸£</option>
            <option value="14">å˜‰ç¾©ç¸£</option>
            <option value="15">å˜‰ç¾©å¸‚</option>
            <option value="16">è‡ºå—å¸‚</option>
            <option value="17">é«˜é›„å¸‚</option>
            <option value="18">å±æ±ç¸£</option>
            <option value="19">èŠ±è“®ç¸£</option>
            <option value="20">è‡ºæ±ç¸£</option>
            <option value="21">æ¾æ¹–ç¸£</option>
            <option value="22">é‡‘é–€ç¸£</option>
            <option value="23">é€£æ±Ÿç¸£</option>
        </select>

        <select id="typeSelect" onchange="applyFilters()">
            <option value="">ğŸ¾ å…¨éƒ¨ç¨®æ—</option>
            <option value="ç‹—">ç‹—ç‹—</option>
            <option value="è²“">è²“å’ª</option>
            <option value="å…¶ä»–">å…¶ä»–å‹•ç‰©</option>
        </select>

        <select id="bodySelect" onchange="applyFilters()">
            <option value="">ğŸ“ å…¨éƒ¨é«”å‹</option>
            <option value="MINI">è¿·ä½ </option>
            <option value="SMALL">å°å‹</option>
            <option value="MEDIUM">ä¸­å‹</option>
            <option value="BIG">å¤§å‹</option>
        </select>

        <select id="ageSelect" onchange="applyFilters()">
            <option value="">ğŸ‚ å…¨éƒ¨å¹´ç´€</option>
            <option value="CHILD">å¹¼å¹´</option>
            <option value="ADULT">æˆå¹´</option>
        </select>

        <select id="colorSelect" onchange="applyFilters()">
            <option value="">ğŸ¨ å…¨éƒ¨é¡è‰²</option>
            <option value="é»‘è‰²">é»‘è‰²</option>
            <option value="ç™½è‰²">ç™½è‰²</option>
            <option value="è™æ–‘">è™æ–‘</option>
            <option value="æ£•è‰²">æ£•è‰²</option>
            <option value="ç°è‰²">ç°è‰²</option>
            <option value="é»ƒè‰²">é»ƒè‰²</option>
            <option value="èŠ±è‰²">èŠ±è‰²</option>
        </select>

        <select id="genderSelect" onchange="applyFilters()">
            <option value="">âš§ï¸ å…¨éƒ¨æ€§åˆ¥</option>
            <option value="M">ç”·ç”Ÿ</option>
            <option value="F">å¥³ç”Ÿ</option>
        </select>

        <button id="sortBtn" class="sort-btn" onclick="toggleSort()">
            â³ æ’åºï¼šå…¥æ‰€æ™‚é–“ (æœ€ä¹…å…ˆ)
        </button>
    </div>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div id="loadingText" style="font-weight:bold; color:#555;">æ­£åœ¨æœå°‹ç­‰å¾…å®¶çš„æ¯›å­©...</div>
    </div>

    <div class="gallery" id="gallery"></div>
    <div class="pagination" id="pagination"></div>

    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal-content">
            <div class="close-btn" onclick="closeModal('force')">Ã—</div>
            <div class="modal-body" id="modalBody">
                </div>
        </div>
    </div>

    <script>
        let rawData = [];
        let displayData = [];
        let currentPage = 1;
        const itemsPerPage = 24;
        let isSortAscending = true; 
        let currentFBText = ""; 

        // æ ¸å¿ƒé‚è¼¯ï¼šä¿æŒæœ€ç©©å®šçš„ç‰ˆæœ¬ (ä¸€æ¬¡æŠ“ 2000 ç­†)
        async function fetchAllData() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            loadingOverlay.style.display = 'flex';
            
            try {
                const apiUrl = `https://data.moa.gov.tw/Service/OpenData/TransService.aspx?UnitId=QcbUEzN6E6DL&$filter=animal_status eq 'OPEN'&$top=2000`;
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('API Error');
                
                rawData = await response.json();
                applyFilters(); 
                
            } catch (error) {
                console.error(error);
                document.getElementById('gallery').innerHTML = '<div style="text-align:center; grid-column:1/-1; padding:30px;">âš ï¸ ç„¡æ³•é€£ç·šè‡³è³‡æ–™åº«ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚</div>';
            } finally {
                loadingOverlay.style.display = 'none';
            }
        }

        function applyFilters() {
            const area = document.getElementById('areaSelect').value;
            const type = document.getElementById('typeSelect').value;
            const body = document.getElementById('bodySelect').value;
            const age = document.getElementById('ageSelect').value;
            const color = document.getElementById('colorSelect').value;
            const gender = document.getElementById('genderSelect').value;

            displayData = rawData.filter(animal => {
                if (area && String(animal.animal_area_pkid) !== String(area)) return false;
                
                if (type) {
                    if (type === 'å…¶ä»–') {
                        if (animal.animal_kind === 'ç‹—' || animal.animal_kind === 'è²“') return false;
                    } else {
                        if (animal.animal_kind !== type) return false;
                    }
                }

                if (body && animal.animal_bodytype !== body) return false;
                if (age && animal.animal_age !== age) return false;
                if (color && animal.animal_colour !== color) return false;
                if (gender && animal.animal_sex !== gender) return false;
                return true;
            });

            executeSort(); 
        }

        function toggleSort() {
            isSortAscending = !isSortAscending;
            const btn = document.getElementById('sortBtn');
            btn.innerHTML = isSortAscending ? 'â³ æ’åºï¼šå…¥æ‰€æ™‚é–“ (æœ€ä¹…å…ˆ)' : 'ğŸ†• æ’åºï¼šå…¥æ‰€æ™‚é–“ (æœ€æ–°å…ˆ)';
            btn.classList.toggle('active', isSortAscending);
            executeSort();
        }

        function executeSort() {
            displayData.sort((a, b) => {
                const dateA = new Date(a.animal_createtime);
                const dateB = new Date(b.animal_createtime);
                return isSortAscending ? dateA - dateB : dateB - dateA;
            });
            currentPage = 1;
            renderGallery();
            renderPagination();
        }

        function calculateDays(dateString) {
            const start = new Date(dateString);
            const now = new Date();
            return Math.floor((now - start) / (1000 * 60 * 60 * 24));
        }

        function formatDate(dateString) {
            if (!dateString) return "";
            const d = new Date(dateString);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}/${month}/${day}`;
        }

        function getDetailedDuration(dateString) {
            const start = new Date(dateString);
            const now = new Date();
            let years = now.getFullYear() - start.getFullYear();
            let months = now.getMonth() - start.getMonth();
            let days = now.getDate() - start.getDate();

            if (days < 0) {
                months--;
                days += new Date(now.getFullYear(), now.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }

            let result = "";
            if (years > 0) result += `${years}å¹´`;
            if (months > 0) result += `${months}å€‹æœˆ`;
            if (days > 0) result += `${days}å¤©`;
            return result || "ä¸åˆ°1å¤©";
        }

        // è½‰æ›é«”å‹ä»£ç¢¼ç‚ºä¸­æ–‡
        function getBodyType(code) {
            const map = { 'MINI': 'è¿·ä½ ', 'SMALL': 'å°å‹', 'MEDIUM': 'ä¸­å‹', 'BIG': 'å¤§å‹' };
            return map[code] || 'æœªæ¨™ç¤º';
        }

        // è½‰æ›å¹´ç´€ä»£ç¢¼ç‚ºä¸­æ–‡
        function getAge(code) {
            const map = { 'CHILD': 'å¹¼å¹´', 'ADULT': 'æˆå¹´' };
            return map[code] || 'æœªæ¨™ç¤º';
        }

        function renderGallery() {
            const gallery = document.getElementById('gallery');
            if (displayData.length === 0) {
                gallery.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #888;">ğŸ• æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„æ¯›å°å­©ï¼Œè©¦è©¦çœ‹æ”¾å¯¬æ¢ä»¶å§ï¼</div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const animalsToShow = displayData.slice(start, end);

            gallery.innerHTML = animalsToShow.map((animal, index) => {
                let imgUrl = animal.album_file || 'https://via.placeholder.com/300x220?text=ç„¡ç…§ç‰‡';
                if (imgUrl.startsWith('http:')) imgUrl = imgUrl.replace('http:', 'https:');

                const days = calculateDays(animal.animal_createtime);
                const genderTag = animal.animal_sex === 'M' ? '<span class="tag male">â™‚ ç”·ç”Ÿ</span>' : (animal.animal_sex === 'F' ? '<span class="tag female">â™€ å¥³ç”Ÿ</span>' : '');
                
                let typeTag = animal.animal_kind === 'ç‹—' ? '<span class="tag dog">ğŸ¶ ç‹—ç‹—</span>' : (animal.animal_kind === 'è²“' ? '<span class="tag cat">ğŸ± è²“å’ª</span>' : `<span class="tag other">ğŸ¾ ${animal.animal_kind}</span>`);

                return `
                <div class="animal-card" onclick="openModal(${start + index})">
                    <img src="${imgUrl}" class="animal-img" loading="lazy" alt="animal">
                    <div class="animal-info">
                        <div class="tag-row">
                            ${typeTag} ${genderTag}
                        </div>
                        <div class="shelter-name">${animal.animal_place || animal.shelter_name}</div>
                        <div style="font-size:13px; color:#666;">${animal.animal_Variety ? animal.animal_Variety.trim() : 'ç±³å…‹æ–¯'} / ${animal.animal_colour}</div>
                        <div class="days-count">ğŸ•’ å·²ç­‰å¾… ${days} å¤©</div>
                    </div>
                </div>
            `}).join('');
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderPagination() {
            if (displayData.length === 0) return;
            const totalPages = Math.ceil(displayData.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            if (totalPages <= 1) return;

            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);
            if (endPage - startPage + 1 < maxButtons) startPage = Math.max(1, endPage - maxButtons + 1);

            const createBtn = (text, page, disabled) => {
                const btn = document.createElement('button');
                btn.textContent = text;
                btn.disabled = disabled;
                btn.className = page === currentPage ? 'active' : '';
                btn.onclick = () => { currentPage = page; renderGallery(); renderPagination(); };
                pagination.appendChild(btn);
            };

            createBtn('Â«', Math.max(1, currentPage - 1), currentPage === 1);
            for (let i = startPage; i <= endPage; i++) createBtn(i, i, false);
            createBtn('Â»', Math.min(totalPages, currentPage + 1), currentPage === totalPages);
        }

        // --- Modal åŠŸèƒ½ (åŠ å…¥é«”å‹èˆ‡å¹´ç´€) ---
        function openModal(index) {
            const animal = displayData[index];
            if (!animal) return;

            const days = calculateDays(animal.animal_createtime);
            const durationText = getDetailedDuration(animal.animal_createtime);
            const formattedOpenDate = formatDate(animal.animal_opendate);
            const formattedCreateDate = formatDate(animal.animal_createtime);

            let imgUrl = animal.album_file || 'https://via.placeholder.com/400x300';
            if (imgUrl.startsWith('http:')) imgUrl = imgUrl.replace('http:', 'https:');
            
            const sibling = animal.animal_sex === 'M' ? 'å¼Ÿå¼Ÿ' : (animal.animal_sex === 'F' ? 'å¦¹å¦¹' : 'æ¯›å­©');
            const sexText = animal.animal_sex === 'M' ? 'ç”·ç”Ÿ' : (animal.animal_sex === 'F' ? 'å¥³ç”Ÿ' : 'æœªæ¨™ç¤º');
            const variety = animal.animal_Variety ? animal.animal_Variety.trim() : 'ç±³å…‹æ–¯';
            const place = animal.animal_place || animal.shelter_name;
            const displayId = animal.animal_subid && animal.animal_subid.trim() !== '' ? animal.animal_subid : animal.animal_id;
            const foundPlace = animal.animal_foundplace || 'ç„¡è³‡æ–™';
            
            // è½‰æ›é«”å‹å’Œå¹´ç´€
            const bodyType = getBodyType(animal.animal_bodytype);
            const ageText = getAge(animal.animal_age);

            currentFBText = `ã€èªé¤Šæ–‡ã€‘æ±‚åˆ†äº« ğŸ \né€™éš»å¯æ„›çš„${variety}${sibling}å·²ç¶“åœ¨${place}ç­‰å®¶${days}å¤©ï¼ˆç›¸ç•¶æ–¼${durationText}ï¼‰äº†ï¼\n\nğŸ¾ æ”¶å®¹ç·¨è™Ÿï¼š${displayId}\nğŸ¾ æ€§åˆ¥ï¼š${sexText}\nğŸ¾ æ¯›è‰²ï¼š${animal.animal_colour}\nğŸ¾ æ‹¾ç²åœ°é»ï¼š${foundPlace}\nğŸ¾ å…¬å‘Šæ”¶å®¹æ‰€ï¼š${place}\nğŸ¾ å¯èªé¤Šæ—¥æœŸï¼š${formattedOpenDate} å¾Œ\nğŸ¾ åœ°é»ï¼š${animal.shelter_address || 'è«‹æ´½æ”¶å®¹æ‰€'}\nğŸ¾ é›»è©±ï¼š${animal.shelter_tel}\n\n#é ˜é¤Šä»£æ›¿è³¼è²· #å‹•ç‰©èªé¤Š`;

            const modalBody = document.getElementById('modalBody');
            
            modalBody.innerHTML = `
                <div class="modal-left">
                    <img src="${imgUrl || 'https://via.placeholder.com/400x300'}" class="modal-img">
                </div>
                <div class="modal-right">
                    <div>
                        <div class="modal-title">${place}</div>
                        <div class="info-grid">
                            <div class="info-item full-width">
                                <span class="info-label">å¯èªé¤Šæ—¥æœŸ</span>
                                <span class="info-value" style="color:#2e7d32">é©åˆèªé¤Š ( ${formattedOpenDate} )</span>
                            </div>
                            <div class="info-item"><span class="info-label">æ”¶å®¹ç·¨è™Ÿ</span><span class="info-value">${displayId}</span></div>
                            <div class="info-item"><span class="info-label">å…¥æ‰€æ—¥æœŸ</span><span class="info-value">${formattedCreateDate}</span></div>
                            
                            <div class="info-item full-width">
                                <span class="info-label">å…¥æ‰€å¤©æ•¸</span>
                                <span class="info-value" style="color:#d32f2f">${days}å¤©ï¼ˆç›¸ç•¶æ–¼${durationText}ï¼‰</span>
                            </div>
                            
                            <div class="info-item"><span class="info-label">æ‹¾ç²åœ°é»</span><span class="info-value">${foundPlace}</span></div>
                            <div class="info-item"><span class="info-label">å…¬å‘Šæ”¶å®¹æ‰€</span><span class="info-value">${place}</span></div>
                            <div class="info-item"><span class="info-label">å“ç¨®</span><span class="info-value">${variety}</span></div>
                            <div class="info-item"><span class="info-label">æ€§åˆ¥</span><span class="info-value">${sexText}</span></div>
                            
                            <div class="info-item"><span class="info-label">é«”å‹</span><span class="info-value">${bodyType}</span></div>
                            <div class="info-item"><span class="info-label">å¹´ç´€</span><span class="info-value">${ageText}</span></div>
                            
                            <div class="info-item"><span class="info-label">æ¯›è‰²</span><span class="info-value">${animal.animal_colour}</span></div>
                            <div class="info-item"><span class="info-label">é›»è©±</span><span class="info-value">${animal.shelter_tel}</span></div>
                            <div class="info-item full-width"><span class="info-label">åœ°é»</span><span class="info-value">${animal.shelter_address || 'è«‹æ´½æ”¶å®¹æ‰€'}</span></div>
                            ${animal.animal_remark ? `<div class="info-item full-width"><span class="info-label">å‚™è¨»</span><span class="info-value" style="color:#666;font-weight:normal">${animal.animal_remark}</span></div>` : ''}
                        </div>
                    </div>
                    <div>
                        <div class="btn-group">
                            <button id="copyBtn" class="action-btn btn-copy" onclick="copyCurrentFBText()">ğŸ“‹ è¤‡è£½èªé¤Šæ–‡</button>
                            <button class="action-btn btn-img" onclick="window.open('${imgUrl}', '_blank')">ğŸ–¼ï¸ é–‹å•ŸåŸå§‹åœ–</button>
                        </div>
                        <div class="tip-text">ğŸ’¡ è¤‡è£½æ–‡å­—å¾Œï¼Œè«‹é–‹å•ŸåŸå§‹åœ–ä¸‹è¼‰ï¼Œå†åˆ° FB è²¼ä¸Šåœ–ç‰‡</div>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function copyCurrentFBText() {
            navigator.clipboard.writeText(currentFBText).then(() => {
                const btn = document.getElementById('copyBtn');
                const originalText = btn.innerHTML;
                btn.innerHTML = 'âœ… å·²è¤‡è£½';
                btn.classList.add('success');
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('success');
                }, 1500);
            }).catch(err => {
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ã€‚');
            });
        }

        function closeModal(event) {
            if (event === 'force' || event.target.id === 'modalOverlay') {
                document.getElementById('modalOverlay').style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }

        fetchAllData();
    </script>
</body>
</html>
